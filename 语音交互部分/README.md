# 语音交互部分 - 极简版

## 概述

本文件夹包含香港科技大学广州智能语音助手的极简版实现，专注于核心的实时语音交互功能。

## 文件结构

```
语音交互部分/
├── simple_voice_assistant.py  # 极简版语音助手 - 主程序
├── voice_config.py           # 语音配置文件
└── README.md                # 本说明文档
```

## 核心功能

### 🎤 极简版语音助手 (`simple_voice_assistant.py`)

一个简洁高效的语音交互系统，包含：

- **实时语音对话**：直接与AI进行语音交流
- **智能打断机制**：用户开始说话时自动打断AI回答
- **完整文本显示**：清晰显示用户输入和AI回答
- **音量检测**：基于音量阈值的简单用户语音检测
- **稳定连接**：与千问Omni API的可靠连接

### 🔧 配置文件 (`voice_config.py`)

提供语音系统的基础配置：
- API密钥管理
- 语音会话参数配置
- 音频设备设置

## 快速开始

### 1. 环境准备

确保已安装必要的依赖：
```bash
pip install numpy pyaudio asyncio websockets
```

### 2. 配置API密钥

在项目根目录的 `config.env` 文件中设置：
```
DASHSCOPE_API_KEY=your_api_key_here
```

### 3. 运行语音助手

```bash
cd 语音交互部分
python simple_voice_assistant.py
```

## 使用说明

### 基本操作

1. **启动程序**：运行后会自动连接千问Omni API
2. **开始对话**：直接说话提问，系统会自动识别
3. **打断AI**：在AI回答时开始说话会自动打断
4. **退出程序**：按 `Ctrl+C` 安全退出

### 对话流程

```
🎤 [正在听取您的问题...]
👤 您说: 你好啊
🤖 [AI正在回答...]
💬 AI: 嗨！有什么能帮到你的吗？
✅ [AI回答完成]
```

### 状态提示

- `🎤 [正在听取您的问题...]` - 检测到用户开始说话
- `👤 您说:` - 显示用户语音识别结果
- `🤖 [AI正在回答...]` - AI开始回答
- `💬 AI:` - 显示AI完整回答内容
- `✅ [AI回答完成]` - AI回答结束
- `⚡ [AI被打断]` - 用户打断了AI回答

## 系统特点

### ✅ 优势

- **简洁高效**：代码精简，专注核心功能
- **稳定可靠**：移除复杂逻辑，减少错误概率
- **易于理解**：清晰的代码结构，便于维护和扩展
- **响应迅速**：优化的处理流程，低延迟响应
- **用户友好**：直观的状态提示和对话格式

### 🔧 技术实现

- **异步处理**：使用asyncio实现高效的并发处理
- **多线程设计**：录音、处理、播放分离，避免阻塞
- **智能缓冲**：音频数据的合理缓冲和流控制
- **错误恢复**：基础的错误处理和状态恢复
- **资源管理**：正确的连接和资源清理

## 故障排除

### 常见问题

1. **连接失败**
   - 检查网络连接
   - 验证API密钥是否正确

2. **音频设备问题**
   - 确认麦克风权限
   - 检查音频设备连接

3. **PyAudio错误**
   - 安装PyAudio：`pip install pyaudio`
   - macOS可能需要：`brew install portaudio`

### 调试提示

- 程序会显示连接状态和设备信息
- 错误信息会直接显示在控制台
- 使用 `Ctrl+C` 可以随时安全退出

## 开发说明

### 代码结构

```python
class SimpleVoiceAssistant(QwenRealtimeVoiceClient):
    - _recording_worker()     # 录音线程
    - _processing_worker()    # 处理线程  
    - _audio_playback_worker() # 播放线程
    - _handle_responses()     # 响应处理
    - _interrupt_ai()         # 打断处理
```

### 扩展指南

如需添加新功能，建议：
1. 在现有简洁架构基础上扩展
2. 保持代码的可读性和稳定性
3. 充分测试新功能的兼容性

## 版本历史

- **v1.0** - 极简版发布，包含核心语音交互功能
- 移除了复杂的性能监控、上下文管理等功能
- 专注于稳定的AI对话体验

## 许可证

本项目遵循项目根目录的许可证条款。

---

🎓 **香港科技大学广州 - 智能语音助手团队** 