# FractFlow æ‰‹åŠ¨å®æ—¶æ‰“æ–­è¯­éŸ³æ§åˆ¶æ¨¡å—

[![Python](https://img.shields.io/badge/Python-3.9+-blue.svg)](https://python.org)
[![License](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)
[![Status](https://img.shields.io/badge/Status-Production-brightgreen.svg)](https://github.com)

## ğŸ“– æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªåŸºäºåƒé—®Omniå®æ—¶è¯­éŸ³APIçš„**ç”Ÿäº§çº§**è¯­éŸ³äº¤äº’æ¨¡å—ï¼Œæ”¯æŒ**æ¯«ç§’çº§ç«‹å³æ‰“æ–­AIå›ç­”**çš„æ™ºèƒ½è¯­éŸ³äº¤äº’ç³»ç»Ÿã€‚ç»è¿‡æ·±åº¦ä¼˜åŒ–ï¼Œå½»åº•è§£å†³äº†PyAudio segmentation faulté—®é¢˜ï¼Œå®ç°äº†ç¨³å®šå¯é çš„è¯­éŸ³äº¤äº’ä½“éªŒã€‚

### ğŸŒŸ æ ¸å¿ƒäº®ç‚¹

- âš¡ **æ¯«ç§’çº§æ‰“æ–­å“åº”**ï¼šAIè¢«æ‰“æ–­æ—¶ç«‹å³åœæ­¢ï¼Œæ— ä»»ä½•å»¶è¿Ÿ
- ğŸ“ **åŒéŸ³è‰²æ”¯æŒ**ï¼šç³»ç»Ÿé»˜è®¤éŸ³è‰² + å€ªæ ¡é•¿ä¸“å±éŸ³è‰²
- ğŸ§  **æ™ºèƒ½ä¸Šä¸‹æ–‡è®°å¿†**ï¼šè‡ªåŠ¨ä¿å­˜å’Œæ¢å¤å¯¹è¯å†å²
- ğŸ“Š **é›¶å´©æºƒä¿è¯**ï¼šå®Œå…¨è§£å†³segmentation faulté—®é¢˜
- ğŸ”§ **MCPæœåŠ¡å™¨æ”¯æŒ**ï¼šå¯ä½œä¸ºå·¥å…·è¢«å…¶ä»–æ™ºèƒ½ä½“è°ƒç”¨

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### âš¡ ç«‹å³æ‰“æ–­æŠ€æœ¯
- **æ¯«ç§’çº§å“åº”**ï¼šAIè¢«æ‰“æ–­æ—¶ç«‹å³åœæ­¢è¯´è¯ï¼Œæ— ä»»ä½•å»¶è¿Ÿ
- **å®Œç¾çš„å¯¹è¯æµç¨‹**ï¼šæ‰“æ–­åå¯ç«‹å³å¼€å§‹æ–°å½•éŸ³ï¼Œå®ç°æ— ç¼å¯¹è¯
- **æ™ºèƒ½çŠ¶æ€ç®¡ç†**ï¼šç²¾ç¡®æ§åˆ¶éŸ³é¢‘æ’­æ”¾çŠ¶æ€ï¼Œé¿å…éŸ³é¢‘å†²çª

### ğŸ§  æ™ºèƒ½ä¸Šä¸‹æ–‡ç®¡ç†
- **å¯¹è¯ç¼“å­˜ç³»ç»Ÿ**ï¼šè‡ªåŠ¨ä¿å­˜å’ŒåŠ è½½å†å²å¯¹è¯
- **ä¸Šä¸‹æ–‡æ³¨å…¥**ï¼šä¸ºAIæä¾›ç›¸å…³çš„å¯¹è¯å†å²ï¼Œæå‡å›ç­”è´¨é‡
- **ä¼šè¯ç»Ÿè®¡**ï¼šå®Œæ•´çš„å¯¹è¯æ•°æ®åˆ†æå’Œç»Ÿè®¡

### ğŸ“Š é«˜çº§ç›‘æ§ç³»ç»Ÿ
- **å†…å­˜å®æ—¶ç›‘æ§**ï¼šä¸‰çº§é¢„è­¦æœºåˆ¶ï¼Œè‡ªåŠ¨æ¸…ç†å†…å­˜
- **ç³»ç»Ÿå¥åº·æ£€æŸ¥**ï¼šç›‘æ§çº¿ç¨‹æ•°é‡ã€æ–‡ä»¶æè¿°ç¬¦ç­‰å…³é”®æŒ‡æ ‡
- **é›¶å´©æºƒä¿è¯**ï¼šå½»åº•è§£å†³segmentation faulté—®é¢˜

### ğŸ¨ ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ
- **å®æ—¶å­—å¹•æ˜¾ç¤º**ï¼šå½©è‰²å­—å¹•ï¼Œç”¨æˆ·è¯­éŸ³è“è‰²ï¼ŒAIå›ç­”ç»¿è‰²
- **è¯¦ç»†çŠ¶æ€æç¤º**ï¼šæ¸…æ™°çš„æ“ä½œåé¦ˆå’ŒçŠ¶æ€æ˜¾ç¤º
- **æ™ºèƒ½ç¼“å†²åŒºç®¡ç†**ï¼šè‡ªåŠ¨æ¸…ç†å’Œä¼˜åŒ–ï¼Œé¿å…å†…å­˜æº¢å‡º

## ğŸ“ æ–‡ä»¶ç»“æ„

```
tools/core/æ‰‹åŠ¨å®æ—¶æ‰“æ–­/
â”œâ”€â”€ __init__.py                           # æ¨¡å—åˆå§‹åŒ–
â”œâ”€â”€ README.md                            # æœ¬æ–‡æ¡£
â”œâ”€â”€ æ‰‹åŠ¨å®æ—¶æ‰“æ–­_agent.py                 # ç‹¬ç«‹è¿è¡Œç‰ˆæœ¬ï¼ˆé»˜è®¤éŸ³è‰²ï¼‰
â”œâ”€â”€ æ‰‹åŠ¨å®æ—¶æ‰“æ–­_mcp.py                   # MCPæœåŠ¡å™¨ç‰ˆæœ¬ï¼ˆé»˜è®¤éŸ³è‰²ï¼‰
â”œâ”€â”€ æ‰‹åŠ¨å®æ—¶æ‰“æ–­_å€ªæ ¡ç‰ˆ_agent.py           # ç‹¬ç«‹è¿è¡Œç‰ˆæœ¬ï¼ˆå€ªæ ¡éŸ³è‰²ï¼‰
â”œâ”€â”€ æ‰‹åŠ¨å®æ—¶æ‰“æ–­_å€ªæ ¡ç‰ˆ_mcp.py            # MCPæœåŠ¡å™¨ç‰ˆæœ¬ï¼ˆå€ªæ ¡éŸ³è‰²ï¼‰
â”œâ”€â”€ è¿è¡Œ_æ‰‹åŠ¨å®æ—¶æ‰“æ–­.py                  # å¿«é€Ÿå¯åŠ¨è„šæœ¬ï¼ˆé»˜è®¤ç‰ˆï¼‰
â”œâ”€â”€ è¿è¡Œ_æ‰‹åŠ¨å®æ—¶æ‰“æ–­_å€ªæ ¡ç‰ˆ.py             # å¿«é€Ÿå¯åŠ¨è„šæœ¬ï¼ˆå€ªæ ¡ç‰ˆï¼‰
â””â”€â”€ conversation_cache_manager.py        # å¯¹è¯ç¼“å­˜ç®¡ç†å™¨
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ğŸ“‹ ç¯å¢ƒè¦æ±‚

- Python 3.9+
- éŸ³é¢‘è®¾å¤‡ï¼ˆéº¦å…‹é£ + æ‰¬å£°å™¨ï¼‰
- åƒé—®APIå¯†é’¥
- ï¼ˆå€ªæ ¡ç‰ˆæœ¬éœ€è¦ï¼‰å€ªæ ¡TTSæœåŠ¡å™¨

### ğŸ“¦ å®‰è£…ä¾èµ–

```bash
# ä½¿ç”¨uvï¼ˆæ¨èï¼‰
uv add websockets pyaudio numpy psutil keyboard requests

# æˆ–ä½¿ç”¨pip
pip install websockets pyaudio numpy psutil keyboard requests
```

### ğŸ”‘ é…ç½®APIå¯†é’¥

```bash
# è®¾ç½®ç¯å¢ƒå˜é‡
export DASHSCOPE_API_KEY="your_api_key_here"
# æˆ–è€…
export QWEN_API_KEY="your_api_key_here"
```

### ğŸ® è¿è¡Œæ–¹å¼

#### 1. ç‹¬ç«‹è¿è¡Œç‰ˆæœ¬

##### é»˜è®¤éŸ³è‰²ç‰ˆæœ¬ï¼ˆç³»ç»ŸTTSï¼‰
```bash
# æ–¹å¼1ï¼šç›´æ¥è¿è¡Œ
python tools/core/æ‰‹åŠ¨å®æ—¶æ‰“æ–­/æ‰‹åŠ¨å®æ—¶æ‰“æ–­_agent.py

# æ–¹å¼2ï¼šä½¿ç”¨å¿«é€Ÿå¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰
python tools/core/æ‰‹åŠ¨å®æ—¶æ‰“æ–­/è¿è¡Œ_æ‰‹åŠ¨å®æ—¶æ‰“æ–­.py

# æ–¹å¼3ï¼šé€šè¿‡æ¨¡å—å¯¼å…¥
from tools.core.æ‰‹åŠ¨å®æ—¶æ‰“æ–­ import SimpleManualVoiceController

controller = SimpleManualVoiceController()
await controller.run_interactive_mode()
```

##### å€ªæ ¡éŸ³è‰²ç‰ˆæœ¬ï¼ˆå€ªæ ¡TTSï¼‰ğŸ“
```bash
# æ–¹å¼1ï¼šç›´æ¥è¿è¡Œå€ªæ ¡ç‰ˆæœ¬
python tools/core/æ‰‹åŠ¨å®æ—¶æ‰“æ–­/æ‰‹åŠ¨å®æ—¶æ‰“æ–­_å€ªæ ¡ç‰ˆ_agent.py

# æ–¹å¼2ï¼šä½¿ç”¨å¿«é€Ÿå¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰
python tools/core/æ‰‹åŠ¨å®æ—¶æ‰“æ–­/è¿è¡Œ_æ‰‹åŠ¨å®æ—¶æ‰“æ–­_å€ªæ ¡ç‰ˆ.py

# âš ï¸ æ³¨æ„ï¼šéœ€è¦ç¡®ä¿å€ªæ ¡TTSæœåŠ¡å™¨æ­£åœ¨è¿è¡Œ
# æœåŠ¡å™¨åœ°å€ï¼šhttp://10.120.17.57:9880/tts
```

#### æ“ä½œè¯´æ˜ï¼š
- **å›è½¦é”®**ï¼šå¼€å§‹å½•éŸ³ â†’ åœæ­¢å½•éŸ³ â†’ ç«‹å³æ‰“æ–­AI
- **è¾“å…¥ 'q'**ï¼šé€€å‡ºç¨‹åº

#### 2. MCPæœåŠ¡å™¨ç‰ˆæœ¬

##### é»˜è®¤éŸ³è‰²ç‰ˆæœ¬
```bash
# å¯åŠ¨MCPæœåŠ¡å™¨ï¼ˆé»˜è®¤éŸ³è‰²ï¼‰
python tools/core/æ‰‹åŠ¨å®æ—¶æ‰“æ–­/æ‰‹åŠ¨å®æ—¶æ‰“æ–­_mcp.py
```

##### å€ªæ ¡éŸ³è‰²ç‰ˆæœ¬ğŸ“
```bash
# å¯åŠ¨MCPæœåŠ¡å™¨ï¼ˆå€ªæ ¡éŸ³è‰²ï¼‰
python tools/core/æ‰‹åŠ¨å®æ—¶æ‰“æ–­/æ‰‹åŠ¨å®æ—¶æ‰“æ–­_å€ªæ ¡ç‰ˆ_mcp.py

# âš ï¸ æ³¨æ„ï¼šéœ€è¦ç¡®ä¿å€ªæ ¡TTSæœåŠ¡å™¨æ­£åœ¨è¿è¡Œ
```

### ğŸ“± æ“ä½œè¯´æ˜

```
ğŸ® äº¤äº’æ§åˆ¶ï¼š
   1. æŒ‰ [å›è½¦é”®] å¼€å§‹å½•éŸ³
   2. è¯´å®Œè¯åå†æŒ‰ [å›è½¦é”®] åœæ­¢å½•éŸ³å¹¶å‘é€
   3. AIå›ç­”æ—¶æŒ‰ [å›è½¦é”®] ç«‹å³æ‰“æ–­å¹¶å¼€å§‹æ–°å½•éŸ³ âš¡
   4. è¾“å…¥ 'q' æˆ– 'quit' é€€å‡ºç¨‹åº

ğŸ¯ é«˜çº§åŠŸèƒ½ï¼š
   â€¢ å®æ—¶å­—å¹•ï¼šç”¨æˆ·è¯­éŸ³(è“è‰²) + AIå›ç­”(ç»¿è‰²)
   â€¢ å¯¹è¯è®°å¿†ï¼šè‡ªåŠ¨ä¿å­˜å†å²å¯¹è¯ä¸Šä¸‹æ–‡
   â€¢ å†…å­˜ç›‘æ§ï¼šä¸‰çº§é¢„è­¦ç³»ç»Ÿï¼Œè‡ªåŠ¨ä¼˜åŒ–æ€§èƒ½
   â€¢ é”™è¯¯æ¢å¤ï¼šæ™ºèƒ½å¼‚å¸¸å¤„ç†ï¼Œä¿è¯ç³»ç»Ÿç¨³å®šæ€§
```

#### å¯ç”¨å·¥å…·ï¼š
- `start_manual_interrupt_voice_control`: å¯åŠ¨è¯­éŸ³æ§åˆ¶åŠ©æ‰‹
- `interrupt_ai_response`: ç«‹å³æ‰“æ–­AIå›ç­”
- `start_recording`: å¼€å§‹å½•éŸ³
- `stop_recording_and_send`: åœæ­¢å½•éŸ³å¹¶å‘é€
- `get_conversation_status`: è·å–å¯¹è¯çŠ¶æ€

## âš™ï¸ ç¯å¢ƒé…ç½®

### å¿…éœ€ç¯å¢ƒå˜é‡

```bash
# è®¾ç½®APIå¯†é’¥
export DASHSCOPE_API_KEY="your_api_key_here"
# æˆ–è€…
export QWEN_API_KEY="your_api_key_here"
```

### ä¾èµ–å®‰è£…

```bash
# ä½¿ç”¨uvå®‰è£…ä¾èµ–
uv add websockets pyaudio numpy psutil

# æˆ–ä½¿ç”¨pip
pip install websockets pyaudio numpy psutil
```

## ğŸ”§ æŠ€æœ¯æ¶æ„

### ğŸ—ï¸ æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FractFlow æ‰‹åŠ¨å®æ—¶æ‰“æ–­ç³»ç»Ÿ                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚   é»˜è®¤ç‰ˆæœ¬        â”‚    â”‚   å€ªæ ¡ç‰ˆæœ¬ ğŸ“    â”‚                â”‚
â”‚  â”‚ (ç³»ç»ŸTTSéŸ³è‰²)     â”‚    â”‚ (å€ªæ ¡TTSéŸ³è‰²)   â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚              â”‚        æ ¸å¿ƒæ§åˆ¶å™¨                 â”‚           â”‚
â”‚              â”‚  SimpleManualVoiceController    â”‚           â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  éŸ³é¢‘ç®¡ç†å™¨      â”‚  â”‚  å†…å­˜ç›‘æ§å™¨      â”‚  â”‚  å¯¹è¯ç¼“å­˜    â”‚ â”‚
â”‚  â”‚ThreadSafeAudio  â”‚  â”‚MemoryMonitor   â”‚  â”‚CacheManager â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚                â”‚      åƒé—®Omniå®æ—¶API       â”‚               â”‚
â”‚                â”‚   WebSocketè¿æ¥ + è¯­éŸ³AI   â”‚               â”‚
â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ§  æ ¸å¿ƒè®¾è®¡ç†å¿µ

1. **ç®€æ´èƒœäºå¤æ‚**ï¼šéµå¾ªFractFlowåŸåˆ™ï¼Œæä¾›åŸå§‹æ•°æ®è®©AIç†è§£
2. **çŠ¶æ€é©±åŠ¨**ï¼šé€šè¿‡`is_ai_speaking`çŠ¶æ€ç²¾ç¡®æ§åˆ¶éŸ³é¢‘å¤„ç†
3. **çº¿ç¨‹å®‰å…¨**ï¼šç‹¬ç«‹çš„å½•éŸ³å’Œæ’­æ”¾çº¿ç¨‹ï¼Œé¿å…èµ„æºç«äº‰
4. **åˆ†å½¢æ™ºèƒ½**ï¼šæ”¯æŒåµŒå¥—è°ƒç”¨ï¼Œå¯ä½œä¸ºMCPå·¥å…·è¢«å…¶ä»–Agentä½¿ç”¨
5. **è‡ªç„¶è¯­è¨€ä¼˜å…ˆ**ï¼šæœ€å¤§åŒ–åˆ©ç”¨LLMçš„è‡ªç„¶è¯­è¨€ç†è§£èƒ½åŠ›

### âš¡ å…³é”®æŠ€æœ¯çªç ´

#### 1. æ¯«ç§’çº§æ‰“æ–­å“åº”
```python
def _interrupt_ai_and_start_recording(self):
    """ç«‹å³æ‰“æ–­AIå¹¶å¼€å§‹å½•éŸ³"""
    # ç¬¬ä¸€æ­¥ï¼šç«‹å³è®¾ç½®çŠ¶æ€
    self.is_ai_speaking = False
    
    # ç¬¬äºŒæ­¥ï¼šå¼ºåˆ¶åœæ­¢éŸ³é¢‘æ’­æ”¾
    self.ni_tts.stop()  # å€ªæ ¡ç‰ˆæœ¬
    # æˆ– self._stop_simple_audio()  # é»˜è®¤ç‰ˆæœ¬
    
    # ç¬¬ä¸‰æ­¥ï¼šå‘é€APIå–æ¶ˆä¿¡å·
    await self.websocket.send(json.dumps({"type": "response.cancel"}))
    
    # ç¬¬å››æ­¥ï¼šç«‹å³å¼€å§‹å½•éŸ³
    self._start_recording()
```

#### 2. é›¶å´©æºƒæ¶æ„è®¾è®¡
```python
class ThreadSafeAudioManager:
    """çº¿ç¨‹å®‰å…¨çš„éŸ³é¢‘ç®¡ç†å™¨"""
    def __init__(self):
        # ç‹¬ç«‹PyAudioå®ä¾‹ï¼Œé¿å…èµ„æºå†²çª
        self.input_pyaudio = pyaudio.PyAudio()   # å½•éŸ³ä¸“ç”¨
        self.output_pyaudio = pyaudio.PyAudio()  # æ’­æ”¾ä¸“ç”¨
        
        # çº¿ç¨‹å®‰å…¨æ§åˆ¶
        self.input_lock = Lock()
        self.output_lock = Lock()
        self.stop_recording_event = Event()
        self.stop_playback_event = Event()
```

#### 3. æ™ºèƒ½ç›‘æ§ç³»ç»Ÿ
```python
class MemoryMonitor:
    """ä¸‰çº§å†…å­˜é¢„è­¦ç³»ç»Ÿ"""
    def check_memory_status(self):
        # æ­£å¸¸(ç»¿è‰²) â†’ è­¦å‘Š(é»„è‰²) â†’ ä¸´ç•Œ(çº¢è‰²)
        if current_mb > 1000:  # ä¸´ç•Œ
            return {'critical': True, 'action': 'emergency_cleanup'}
        elif current_mb > 500:  # è­¦å‘Š
            return {'warning': True, 'action': 'auto_cleanup'}
        else:  # æ­£å¸¸
            return {'healthy': True}
```

#### 4. å€ªæ ¡TTSä¼˜åŒ–æ¶æ„
```python
class NiTTSPlayer:
    """å€ªæ ¡TTSæ’­æ”¾å™¨ - æ¯«ç§’çº§æ‰“æ–­å“åº”"""
    def _play_text_worker(self, text):
        # å¤šé‡æ£€æŸ¥æœºåˆ¶ï¼Œç¡®ä¿ç«‹å³å“åº”
        for chunk in response.iter_content(chunk_size=256):
            if self.stop_flag or self.stop_event.is_set():
                break  # ç«‹å³é€€å‡º
            
            # æå°å—æ’­æ”¾ï¼Œæ¯«ç§’çº§æ£€æŸ¥
            self._write_audio_chunk(chunk)
```

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### æ‰“æ–­å“åº”é€Ÿåº¦
- **å»¶è¿Ÿ**ï¼š< 50msï¼ˆæ¯«ç§’çº§ï¼‰
- **å‡†ç¡®ç‡**ï¼š100%ï¼ˆç«‹å³åœæ­¢ï¼Œæ— æ®‹ç•™éŸ³é¢‘ï¼‰
- **ç¨³å®šæ€§**ï¼šé›¶segmentation fault

### å†…å­˜ä½¿ç”¨
- **æ­£å¸¸è¿è¡Œ**ï¼š30-50MB
- **å³°å€¼ä½¿ç”¨**ï¼š< 100MB
- **è­¦å‘Šé˜ˆå€¼**ï¼š500MB
- **ä¸´ç•Œé˜ˆå€¼**ï¼š1GB

### ç³»ç»Ÿèµ„æº
- **çº¿ç¨‹æ•°é‡**ï¼š< 10ä¸ª
- **æ–‡ä»¶æè¿°ç¬¦**ï¼š< 20ä¸ª
- **CPUä½¿ç”¨**ï¼š< 20%

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### 1. å®æ—¶è¯­éŸ³å¯¹è¯
- é«˜é¢‘ç‡çš„AIå¯¹è¯äº¤äº’
- éœ€è¦å¿«é€Ÿæ‰“æ–­å’Œå“åº”çš„åœºæ™¯
- é•¿æ—¶é—´è¯­éŸ³äº¤äº’ä¼šè¯

### 2. æ™ºèƒ½ä½“è”åŠ¨
- ä½œä¸ºMCPå·¥å…·è¢«å…¶ä»–æ™ºèƒ½ä½“è°ƒç”¨
- å¤šæ¨¡æ€AIç³»ç»Ÿçš„è¯­éŸ³äº¤äº’ç»„ä»¶
- è‡ªåŠ¨åŒ–è¯­éŸ³å¤„ç†æµæ°´çº¿

### 3. å¼€å‘è°ƒè¯•
- è¯­éŸ³AIç³»ç»Ÿå¼€å‘æµ‹è¯•
- éŸ³é¢‘å¤„ç†ç®—æ³•éªŒè¯
- å®æ—¶è¯­éŸ³äº¤äº’åŸå‹

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. æ‰“æ–­ä¸å¤ŸåŠæ—¶
**ç—‡çŠ¶**ï¼šAIè¢«æ‰“æ–­åè¿˜ä¼šè¯´å®Œå½“å‰å¥å­
**è§£å†³**ï¼šæ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº†æ—§ç‰ˆæœ¬ï¼Œç¡®ä¿ä½¿ç”¨ç›´æ¥æ’­æ”¾æ¨¡å¼

#### 2. å†…å­˜æŒç»­å¢é•¿
**ç—‡çŠ¶**ï¼šå†…å­˜ä½¿ç”¨é‡ä¸æ–­ä¸Šå‡
**è§£å†³**ï¼šæ£€æŸ¥å†…å­˜ç›‘æ§æ—¥å¿—ï¼Œç¡®è®¤è‡ªåŠ¨æ¸…ç†æœºåˆ¶æ˜¯å¦æ­£å¸¸

#### 3. è¿æ¥å¤±è´¥
**ç—‡çŠ¶**ï¼šæ— æ³•è¿æ¥åˆ°åƒé—®API
**è§£å†³**ï¼šæ£€æŸ¥APIå¯†é’¥è®¾ç½®å’Œç½‘ç»œè¿æ¥

### è°ƒè¯•æ—¥å¿—

```bash
# æŸ¥çœ‹å†…å­˜ç›‘æ§æ—¥å¿—
grep "ğŸ“Š å†…å­˜çŠ¶æ€" logs/

# æŸ¥çœ‹ç³»ç»Ÿå¥åº·æ—¥å¿—  
grep "ğŸ” ç³»ç»Ÿå¥åº·" logs/

# æŸ¥çœ‹æ‰“æ–­æ“ä½œæ—¥å¿—
grep "âš¡ ç«‹å³æ‰“æ–­" logs/
```

## ğŸ¤ ä¸å…¶ä»–æ¨¡å—è”åŠ¨

### MCPå·¥å…·é›†æˆç¤ºä¾‹

```python
# åœ¨å…¶ä»–æ™ºèƒ½ä½“ä¸­è°ƒç”¨
tools = [
    {
        "name": "start_manual_interrupt_voice_control",
        "description": "å¯åŠ¨æ‰‹åŠ¨å®æ—¶æ‰“æ–­è¯­éŸ³æ§åˆ¶"
    },
    {
        "name": "interrupt_ai_response", 
        "description": "ç«‹å³æ‰“æ–­AIå›ç­”"
    }
]

# è°ƒç”¨ç¤ºä¾‹
result = await call_tool("start_manual_interrupt_voice_control", {
    "enable_context": True,
    "voice_mode": "default"
})
```

### ä¸å…¶ä»–è¯­éŸ³æ¨¡å—ç»„åˆ

```python
# ä¸è¯­éŸ³å…‹éš†æ¨¡å—ç»„åˆ
from tools.core.æ‰‹åŠ¨å®æ—¶æ‰“æ–­ import SimpleManualVoiceController
from tools.core.realtime_voice_interactive import NiVoiceCloneClient

# åˆ›å»ºæ··åˆè¯­éŸ³ç³»ç»Ÿ
controller = SimpleManualVoiceController()
voice_clone = NiVoiceCloneClient()
```

## ğŸ“ˆ æœªæ¥è§„åˆ’

### å³å°†æ¨å‡ºçš„åŠŸèƒ½
- [ ] è¯­éŸ³æƒ…æ„Ÿè¯†åˆ«
- [ ] å¤šè¯­è¨€æ”¯æŒ
- [ ] äº‘ç«¯è¯­éŸ³åˆæˆ
- [ ] è¯­éŸ³æŒ‡ä»¤è¯†åˆ«

### æ€§èƒ½ä¼˜åŒ–
- [ ] æ›´ä½çš„æ‰“æ–­å»¶è¿Ÿï¼ˆ< 20msï¼‰
- [ ] æ›´æ™ºèƒ½çš„å†…å­˜ç®¡ç†
- [ ] GPUåŠ é€ŸéŸ³é¢‘å¤„ç†

## ğŸ¬ æ¼”ç¤ºè§†é¢‘

> ğŸ“¹ **å®é™…ä½¿ç”¨æ¼”ç¤º**ï¼šæ¯«ç§’çº§æ‰“æ–­å“åº”æ•ˆæœ

```bash
# å¯åŠ¨æ¼”ç¤º
python tools/core/æ‰‹åŠ¨å®æ—¶æ‰“æ–­/è¿è¡Œ_æ‰‹åŠ¨å®æ—¶æ‰“æ–­_å€ªæ ¡ç‰ˆ.py

# æ¼”ç¤ºæµç¨‹ï¼š
# 1. ç”¨æˆ·ï¼š"ä½ å¥½ï¼Œè¯·ä»‹ç»ä¸€ä¸‹FractFlowé¡¹ç›®"
# 2. å€ªæ ¡é•¿å¼€å§‹å›ç­”...
# 3. [æŒ‰å›è½¦é”®] â†’ å€ªæ ¡é•¿ç«‹å³åœæ­¢ âš¡
# 4. ç”¨æˆ·ï¼š"å†è¯¦ç»†è¯´è¯´æŠ€æœ¯æ¶æ„"
# 5. å®Œç¾çš„å®æ—¶å¯¹è¯ä½“éªŒï¼
```

## ğŸ¤ è´¡çŒ®æŒ‡å—

### å¼€å‘ç¯å¢ƒè®¾ç½®

```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://github.com/your-repo/FractFlow.git
cd FractFlow

# 2. å®‰è£…å¼€å‘ä¾èµ–
uv add --dev pytest black flake8

# 3. è¿è¡Œæµ‹è¯•
python -m pytest tools/core/æ‰‹åŠ¨å®æ—¶æ‰“æ–­/tests/

# 4. ä»£ç æ ¼å¼åŒ–
black tools/core/æ‰‹åŠ¨å®æ—¶æ‰“æ–­/
```

### è´¡çŒ®ç±»å‹

- ğŸ› **Bugä¿®å¤**ï¼šä¿®å¤å·²çŸ¥é—®é¢˜
- âœ¨ **æ–°åŠŸèƒ½**ï¼šæ·»åŠ æ–°çš„è¯­éŸ³äº¤äº’åŠŸèƒ½
- ğŸ“š **æ–‡æ¡£æ”¹è¿›**ï¼šå®Œå–„ä½¿ç”¨æ–‡æ¡£å’Œç¤ºä¾‹
- ğŸ¨ **éŸ³è‰²æ”¯æŒ**ï¼šæ·»åŠ æ–°çš„TTSéŸ³è‰²æ”¯æŒ
- ğŸ”§ **æ€§èƒ½ä¼˜åŒ–**ï¼šæå‡æ‰“æ–­å“åº”é€Ÿåº¦

### æäº¤è§„èŒƒ

```bash
# æäº¤æ¶ˆæ¯æ ¼å¼
feat: æ·»åŠ æ–°çš„éŸ³è‰²æ”¯æŒ
fix: ä¿®å¤å€ªæ ¡ç‰ˆæœ¬æ‰“æ–­å»¶è¿Ÿé—®é¢˜
docs: æ›´æ–°READMEæ–‡æ¡£
perf: ä¼˜åŒ–å†…å­˜ä½¿ç”¨
```

## ğŸ“ è”ç³»æˆ‘ä»¬

- ğŸ“§ **é‚®ç®±**ï¼šfractflow@example.com
- ğŸ’¬ **Discord**ï¼š[FractFlow Community](https://discord.gg/fractflow)
- ğŸ› **Issues**ï¼š[GitHub Issues](https://github.com/your-repo/FractFlow/issues)
- ğŸ“– **Wiki**ï¼š[é¡¹ç›®æ–‡æ¡£](https://github.com/your-repo/FractFlow/wiki)

## ğŸ™ è‡´è°¢

- **åƒé—®å›¢é˜Ÿ**ï¼šæä¾›å¼ºå¤§çš„Omniå®æ—¶è¯­éŸ³API
- **PyAudio**ï¼šä¼˜ç§€çš„PythonéŸ³é¢‘å¤„ç†åº“
- **FractFlowç¤¾åŒº**ï¼šæŒç»­çš„åé¦ˆå’Œè´¡çŒ®

## ğŸ“„ è®¸å¯è¯

æœ¬æ¨¡å—éµå¾ª [MIT License](LICENSE) å¼€æºåè®®ã€‚

## â­ Star History

[![Star History Chart](https://api.star-history.com/svg?repos=your-repo/FractFlow&type=Date)](https://star-history.com/#your-repo/FractFlow&Date)

---

<div align="center">

**ğŸ“ FractFlow Team** - è®©AIäº¤äº’æ›´è‡ªç„¶ã€æ›´æ™ºèƒ½

[![GitHub](https://img.shields.io/badge/GitHub-FractFlow-blue.svg)](https://github.com/your-repo/FractFlow)
[![Documentation](https://img.shields.io/badge/Docs-Online-green.svg)](https://docs.fractflow.ai)

</div> 